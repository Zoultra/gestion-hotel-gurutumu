 <form [formGroup]="reservationForm" (ngSubmit)="submitModification()" class="p-3 border rounded">
  <!-- Section Dates -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">Date début</label>
      <input type="date" class="form-control" formControlName="dateDebut" 
             [class.is-invalid]="reservationForm.get('dateDebut')?.invalid && reservationForm.get('dateDebut')?.touched" />
      <div class="invalid-feedback" *ngIf="reservationForm.get('dateDebut')?.invalid">
        La date de début est requise
      </div>
    </div>

 
    <div class="col-md-4">
      <label class="form-label">CODE</label>
      <input type="text" class="form-control" formControlName="code" 
             [class.is-invalid]="reservationForm.get('code')?.invalid && reservationForm.get('code')?.touched" />
      <div class="invalid-feedback" *ngIf="reservationForm.get('code')?.invalid">
        La date de début est requise
      </div>
    </div>
    
    <div class="col-md-4">
      <label class="form-label">Date fin</label>
      <input type="date" class="form-control" formControlName="dateFin"
             [class.is-invalid]="reservationForm.get('dateFin')?.invalid && reservationForm.get('dateFin')?.touched" />
      <div class="invalid-feedback" *ngIf="reservationForm.get('dateFin')?.invalid">
        La date de fin est requise
      </div>
    </div>
    
   <div class="col-md-4">
  <label class="form-label">Client</label>
 <select class="form-select" formControlName="client_id">
  <option value="">Sélectionnez un client</option>
  <option *ngFor="let client of clients" 
          [value]="client.id"
          [selected]="client.id === reservationForm.get('client_id')?.value">
    {{ client.nom }} {{ client.prenom }}
  </option>
</select>
  <div class="invalid-feedback" *ngIf="reservationForm.get('client_id')?.errors?.['required']">
    Le client est requis
  </div>
</div>
  </div>

  <!-- Section Lignes de réservation -->
  <h5 class="mt-3">Lignes de réservation</h5>
  
  <div formArrayName="lignes">
    <div *ngFor="let ligne of lignes.controls; let i = index" class="border rounded p-2 mb-2">
      <div [formGroupName]="i" class="row g-2">
        <!-- Type -->
        <div class="col-md-2">
          <label class="form-label">Type</label>
          <select class="form-select" formControlName="type"
                  (change)="onTypeChange(ligne, i)">
            <option value="">Sélectionnez</option>
            <option value="CHAMBRE">Chambre</option>
            <option value="SALLE">Salle</option>
          </select>
        </div>
        
        <!-- Chambre/Salle -->
        <div class="col-md-3">
          <label class="form-label">{{ ligne.get('type')?.value === 'CHAMBRE' ? 'Chambre' : 'Salle' }}</label>
          <select class="form-select" formControlName="idObjet"
                  [disabled]="!ligne.get('type')?.value"
                >
            <option value="">Sélectionnez {{ ligne.get('type')?.value === 'CHAMBRE' ? 'une chambre' : 'une salle' }}</option>
            <option *ngFor="let obj of ligne.get('type')?.value === 'CHAMBRE' ? chambres : salles"
                    [value]="obj.id">
              {{ obj.numero || obj.nom }} - {{ obj.etat }} - {{ obj.statut }}
            </option>
          </select>
        </div>
        
        <!-- Prix Unitaire -->
        <div class="col-md-2">
          <label class="form-label">Prix unitaire</label>
          <div class="input-group">
            <input type="text" class="form-control" formControlName="prixUnitaire" readonly />
            <span class="input-group-text">FCFA</span>
          </div>
        </div>
        
        <!-- Nombre de jours -->
        <div class="col-md-2">
          <label class="form-label">Nombre de jours</label>
          <input type="number" min="1" class="form-control" formControlName="nombreJours" />
        </div>
        
        <!-- Montant Total -->
        <div class="col-md-2">
          <label class="form-label">Sous Total</label>
          <div class="input-group">
            <input type="text" class="form-control" 
                   [value]="calculateLineTotal(ligne)" readonly />
            <span class="input-group-text">FCFA</span>
          </div>
        </div>
        
        <!-- Bouton Supprimer -->
        <div class="col-md-1 d-flex align-items-end">
          <button type="button" class="btn btn-outline-danger w-100" (click)="removeLigne(i)"
                  [disabled]="lignes.length <= 1">
            <i class="fa fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Boutons d'action -->
  <div class="row mt-4">
    <div class="col-md-4">
      <button type="button" class="btn btn-outline-primary" (click)="addLigne()">
        <i class="fa fa-plus me-2"></i>Ajouter une ligne
      </button>
    </div>
    
    <div class="row mt-4">
  <div>
  <label class="form-label">Montant Total</label>
          <div class="input-group">
            <input type="text" class="form-control" 
                   [value]="getMontantTotal()" readonly />
            <span class="input-group-text">FCFA</span>
          </div>
    </div>
    <div>
  <label class="form-label">Montant Remise</label>
          <div class="input-group">
            <input type="number" class="form-control" 
        formControlName="montantRemise" min="0" required="" />
            <span class="input-group-text">FCFA</span>
          </div>
    </div>
    <div>
  <label class="form-label">Montant Net</label>
          <div class="input-group">
            <input type="text" class="form-control" 
                  type="number"  [value]="mettreAJourMontants()"  readonly />
            <span class="input-group-text">FCFA</span>
          </div>
    </div>
 </div>
 
    <div class="col-md-4 text-center">
      <button type="submit" class="btn btn-success px-4">
        <i class="fa fa-save me-2"></i>Modifier
      </button>
    </div>
    
    <div class="col-md-4 text-end">
      <button type="button" class="btn btn-outline-secondary" (click)="goToReservationList()">
        <i class="fa fa-arrow-left me-2"></i>Retour à la liste
      </button>
    </div>
  </div>
  
  <!-- Affichage des erreurs -->
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>
</form>